<app-cabecalho></app-cabecalho>

<div class="header">
  <div class="header--sub">
    <div class="group--title">
      <div class="title">
        <div class="title--sub">
          <p class="tertiary">Dashboard / Tarefas / Projetos / #4</p>
          <h3>JAL - Sistema de priorização de tarefas</h3>
        </div>
        <div class="group">
          <div class="badge"><p>Em andamento</p></div>
          <div class="badge success"><p>15.5</p></div>
        </div>
      </div>
    </div>
  </div>
  <div class="header--sub" id="highlight_change">
    <div class="group--highlight" id="highlight_geral" [class.hide]="abaSelecionada !== 'geral'">
      <div class="highlight border-left--add" *ngFor="let h of highlightsGeral">
        <div class="highlight--data">
          <div class="highlight--data--sub">
            <svg *ngIf="h.label === 'Ligadas'" class="icon icone-link w-4 h-4 text-[#D1E3FA94]">
              <use href="#icone-link"></use>
            </svg>
            <svg *ngIf="h.label === 'Concluídas'" class="icon">
              <use xlink:href="#icon-check-circle"></use>
            </svg>
            <h6>{{h.label}}</h6>
          </div>
          <h1>{{h.value}}</h1>
        </div>
        <div class="highlight--label" [ngClass]="h.type"></div>
      </div>
    </div>
    <div class="group--highlight" id="highlight_eventos" [class.hide]="abaSelecionada !== 'eventos'">
      <div class="highlight border-left--add" *ngFor="let h of highlightsEventos">
        <div class="highlight--data">
          <div class="highlight--data--sub">
            <svg *ngIf="h.label === 'Em andamento'" class="icon">
              <use xlink:href="#icon-clock"></use>
            </svg>
            <svg *ngIf="h.label === 'Aguardando'" class="icon">
              <use xlink:href="#icon-pause-circle"></use>
            </svg>
            <h6>{{h.label}}</h6>
          </div>
        <h1 [title]="convertHorasToDiasHoras(h.value)">
            {{h.value}}
        </h1>
        </div>
        <div class="highlight--label" [ngClass]="h.type"></div>
      </div>
    </div>
  </div>
</div>

<div class="tabsheet" id="tabsheet_bar">
  <button
    *ngFor="let tab of tabs"
    class="tabsheet--button"
    [class.active]="abaSelecionada === tab.value"
    (click)="abaSelecionada = tab.value">
    <div class="tabsheet--title">
      <p>{{tab.label}}</p>
    </div>
    <div class="tabsheet--label"></div>
  </button>
</div>

<!-- Kanban Geral -->
<div class="kanban--content tabsheet--body kanban--content--geral" *ngIf="abaSelecionada === 'geral'">
  <div class="kanban--column" *ngFor="let col of kanbanGeral">
    <div class="group--title size-s">
      <div class="title">
        <h4>{{col.nome}}</h4>
        <div class="badge" [ngClass]="col.status.type"><p>{{col.status.label}}</p></div>
      </div>
    </div>
    <div class="kanban--column--body">
      <div class="kanban--card" *ngFor="let card of col.cards">
        <p class="tertiary">{{card.id}}</p>
        <h4>{{card.titulo}}</h4>
        <div class="group" *ngIf="card.owner">
          <img class="avatar" [src]="card.avatar" alt="Ícone de avatar" />
          <p>{{card.owner}}</p>
        </div>
        <p class="tertiary" *ngIf="card.descricao">{{card.descricao}}</p>
        <p class="tertiary" *ngIf="card.expectativa">{{card.expectativa}}</p>
        <div class="group">
          <ng-container *ngIf="card.badges && card.badges.length; else badgeDefault">
            <div class="badge" *ngFor="let b of card.badges" [ngClass]="b.type"><p>{{b.label}}</p></div>
          </ng-container>
          <ng-template #badgeDefault>
            <div class="badge" [ngClass]="card.status.type"><p>{{card.status.label}}</p></div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Kanban Eventos -->
<div class="kanban--content tabsheet--body kanban--content--eventos" *ngIf="abaSelecionada === 'eventos'">
    <div class="kanban--column" *ngFor="let col of kanbanEventos">
        <div class="group--title size-s">
            <div class="title">
                <h4>{{col.nome}}</h4>
                <div class="badge" [ngClass]="col.status.type">
                    <p>{{col.status.label}}</p>
                </div>
            </div>
        </div>
        <div class="group--highlight" *ngIf="col.highlights">
            <div class="highlight size-s" *ngFor="let h of col.highlights">
                <div class="highlight--data">
                    <svg *ngIf="h.label === 'Em andamento'" class="icon">
                        <use xlink:href="#icon-clock"></use>
                    </svg>
                    <svg *ngIf="h.label === 'Aguardando'" class="icon">
                        <use xlink:href="#icon-pause-circle"></use>
                    </svg>
                    <h4 [title]="convertHorasToDiasHoras(h.value)">
                        {{h.value}}
                    </h4>
                </div>
                <div class="highlight--label" [ngClass]="h.type"></div>
            </div>
        </div>
        <div class="kanban--column--body">
            <ng-container *ngFor="let card of col.cards">
                <!-- Headerzinho centralizado, ícone colado ao lado da hora -->
                <div class="kanban--card-header" *ngIf="card.score && card.id">
                    <span class="card-header-id">{{card.id}}</span>
                    <span style="display: flex; align-items: center; margin-left: 10px; gap: 4px;">
                        <svg width="16" height="16" class="card-header-icon">
                            <use xlink:href="#icon-circle-minus"></use>
                        </svg>
                        <span class="card-header-score">{{card.score}}</span>
                    </span>
                </div>
                <!-- Cards normais -->
                <div class="kanban--card" *ngIf="!card.score || !card.id">
                    <div class="card-info-custom">
                        <div class="badge" [ngClass]="card.status.type" *ngIf="card.status.label">
                            <p>{{card.status.label}}</p>
                        </div>
                        <div class="group" *ngIf="card.badges && card.badges.length">
                            <svg class="icon" height="40" *ngIf="card.status.label === 'Em andamento'">
                                <use xlink:href="#icon-clock"></use>
                            </svg>
                            <svg class="icon" height="40"
                                *ngIf="card.status.label === 'Aguardando Cliente' || card.status.label === 'Aguardando Projetos' || card.status.label === 'Aguardando Produtos'">
                                <use xlink:href="#icon-pause-circle"></use>
                            </svg>
                            <p *ngIf="card.badges[0]?.label">{{card.badges[0].label}}</p>
                        </div>
                        <p class="tertiary">{{card.descricao}}</p>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</div>

<!-- Popover com Score -->
<div class="popover">
  <table>
    <tr>
      <th>Categoria</th>
      <th class="right">Peso</th>
      <th class="column--div">Classificação</th>
      <th class="right">Score</th>
      <th class="right column--div">Score sub-total</th>
    </tr>
    <tr *ngFor="let linha of popoverScore">
      <td>{{linha.categoria}}</td>
      <td class="right">{{linha.peso}}</td>
      <td class="column--div">
        <div class="badge"><p>{{linha.classificacao}}</p></div>
      </td>
      <td>
        <div class="group right">
          <div class="badge" [ngClass]="linha.type"><p>{{linha.score}}</p></div>
        </div>
      </td>
      <td class="column--div">
        <div class="group right">
          <div class="badge" [ngClass]="linha.type"><p>{{linha.subTotal}}</p></div>
        </div>
      </td>
    </tr>
  </table>
</div>