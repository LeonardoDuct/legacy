<section class="kickoff-fluxo">
    <app-cabecalho></app-cabecalho>

    <section class="header-bottom">
        <article class="bloco-tecnologia">
            <div class="conteudo">
                <div class="topo-bloco">
                    <app-voltar (voltar)="voltar()"></app-voltar>
                    <div class="info-projeto">
                        <span class="breadcrumb">Dashboard / Kickoff</span>
                        <div class="linha-titulo">
                            <h2 class="titulo">Fluxo de IS</h2>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <article class="bloco-indicadores">
            <div class="pendente">
                <div class="icon">
                    <svg class="size-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <use href="#icone-pendente"></use>
                    </svg>
                </div>
                <div class="texto-numero">
                    <div class="texto">Pendentes</div>
                </div>
            </div>

            <div class="atrasadas">
                <div class="icon">
                    <svg class="size-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <use href="#icone-atrasadas"></use>
                    </svg>
                </div>
                <div class="texto-numero">
                    <div class="texto">Atrasadas</div>

                </div>
            </div>

            <div class="aguardando-setor">
                <div class="icon">
                    <svg class="size-6" viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16"
                        style="width: 22px; height: 22px;">
                        <use href="#icone-aguardando"></use>
                    </svg>
                </div>
                <div class="texto-numero">
                    <div class="texto">Aguardando</div>

                </div>

            </div>
            <div class="divider div1"></div>
            <div class="divider div2"></div>

        </article>

        <aside class="bloco-filtro">
            <div class="filtro-container">
                <div class="dropdown-wrapper">
                    <select id="tipo-filtro" class="dropdown" [(ngModel)]="filtroColuna"
                        (change)="onFiltroColunaChange($event)">
                        <option value="" disabled selected>Selecione uma coluna</option>
                        <option value="kickoff">Kickoff</option>
                        <option value="abert_kickoff">Abert x Kickoff</option>
                        <option value="abert_analise">Abert Análise</option>
                        <option value="kickoff_analise">Kickoff x Análise</option>
                        <option value="abert_dev">Abert DEV</option>
                        <option value="analise_dev">Análise x DEV</option>
                        <option value="abert_qa">Abert QA</option>
                        <option value="dev_qa">DEV x QA</option>
                        <option value="em_prod">Em Prod</option>
                        <option value="qa_prod">QA x Prod</option>
                        <option value="total_dias">Total Dias</option>
                    </select>
                </div>
                <div class="input-wrapper">
                    <input type="text" id="filtro-descricao" class="input-text" placeholder="Digite o filtro"
                        [(ngModel)]="filtroValor" />
                    <button class="btn btn-search" type="button">
                        <svg class="icon-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <use href="#icone-lupa"></use>
                        </svg>
                    </button>
                </div>
            </div>
        </aside>
    </section>

    <section class="tabela-container">
        <div class="tabela-scroll">
            <table class="tabela-fluxo">
                <thead>
                    <tr>
                        <th class="col-is">IS</th>
                        <th class="col-kickoff">Kickoff</th>
                        <th class="col-abert-analise">Abert Análise</th>
                        <th class="col-abert-dev">Abert DEV</th>
                        <th class="col-abert-qa">Abert QA</th>
                        <th class="col-prod">Prod</th>
                        <th class="col-total-dias">Total dias</th>
                        <th class="col-acoes">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let is of isListFiltrada">
                        <td class="col-is">{{ is.nome }}</td>
                        <!-- Kickoff -->
                        <td class="col-kickoff cell-tooltip">
                            {{ is.kickOffDate | date: 'dd/MM/yyyy HH:mm' }}
                            <div class="tooltip-content">
                                <div>
                                    <strong>Abertura Sustentação x Kickoff:</strong>
                                    {{ calcularDias(is.kickOffDate, is.setores.analise.entrada) }} dias
                                </div>
                                <div>
                                    <strong>Interações (comentários/reunião Kickoff):</strong>
                                    {{ getInteracoes(is, 'analise') }}
                                </div>
                            </div>
                        </td>
                        <!-- Abert Análise -->
                        <td class="col-abert-analise cell-tooltip">
                            {{ is.setores.analise.entrada | date:'dd/MM/yyyy HH:mm' }}
                            <div class="tooltip-content">
                                <div>
                                    <strong>Desde Kickoff até abert Análise:</strong>
                                    {{ calcularDias(is.kickOffDate, is.setores.analise.entrada) }} dias
                                </div>
                                <div>
                                    <strong>Interações (da Sustentação p/ Análise):</strong>
                                    {{ getInteracoes(is, 'analise') }}
                                </div>
                            </div>
                        </td>
                        <!-- Abert DEV -->
                        <td class="col-abert-dev cell-tooltip">
                            {{ is.setores.dev.entrada | date:'dd/MM/yyyy HH:mm' }}
                            <div class="tooltip-content">
                                <div>
                                    <strong>Desde Abert Análise até abert DEV:</strong>
                                    {{ calcularDias(is.setores.analise.saida, is.setores.dev.entrada) }} dias
                                </div>
                                <div>
                                    <strong>Interações (da Análise para DEV):</strong>
                                    {{ getInteracoes(is, 'dev') }}
                                </div>
                            </div>
                        </td>
                        <!-- Abert QA -->
                        <td class="col-abert-qa cell-tooltip">
                            {{ is.setores.qa.entrada | date:'dd/MM/yyyy HH:mm' }}
                            <div class="tooltip-content">
                                <div>
                                    <strong>Desde abert DEV até disponível para QA Homolog:</strong>
                                    {{ calcularDias(is.setores.dev.saida, is.setores.qa.entrada) }} dias
                                </div>
                                <div>
                                    <strong>Interações (de volta para DEV após QA):</strong>
                                    {{ getInteracoes(is, 'qa') }}
                                </div>
                            </div>
                        </td>
                        <!-- Prod -->
                        <td class="col-prod cell-tooltip">
                            {{ is.setores.prod.entrada | date:'dd/MM/yyyy HH:mm' }}
                            <div class="tooltip-content">
                                <div>
                                    <strong>Desde que aberto em QA até subida em Prod:</strong>
                                    {{ calcularDias(is.setores.qa.saida, is.setores.prod.entrada) }} dias
                                </div>
                                <div>
                                    <strong>Interações (de volta para QA para Infra/Prod):</strong>
                                    {{ getInteracoes(is, 'prod') }}
                                </div>
                            </div>
                        </td>
                        <!-- Total dias -->
                        <td class="col-total-dias cell-tooltip">
                            {{ calcularTotalDias(is) }} dias
                            <div class="tooltip-content">
                                <strong>Total de interações (soma de todas interações):</strong>
                                {{ getTotalInteracoes(is) }}
                            </div>
                        </td>
                        <!-- AÇÕES -->
                        <td class="col-acoes">
                            <button class="btn btn-detalhes" type="button" (click)="abrirDetalhe(is)">Detalhes</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</section>