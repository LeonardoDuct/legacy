<app-cabecalho></app-cabecalho>

<section class="header-bottom">
  <article class="bloco-tecnologia">
    <div class="topo-bloco">
      <app-voltar (voltar)="voltar()"></app-voltar>
      <div class="conteudo">
        <h2 class="titulo">Cadastro</h2>
        <span class="status">Usuários</span>
      </div>
    </div>
  </article>

  <aside class="bloco-filtro">
    <div class="filtro-container">
      <div class="dropdown-wrapper">
        <select id="tipo-filtro" class="dropdown">
          <option value="" disabled selected>Selecione uma coluna</option>
          <option value="classificacao">Nome</option>
          <option value="descricao">Email</option>
          <option value="score">Adminstrador</option>
        </select>
      </div>

      <!-- Input de texto -->
      <div class="input-wrapper">
        <input type="text" id="filtro-descricao" class="input-text" placeholder="Digitar filtro" />
        <button class="btn btn-search">
          <svg class="icon-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <use href="#icone-lupa"></use>
          </svg>
        </button>
      </div>
    </div>
  </aside>
</section>

<section class="cadastro-page">
  <!-- Botão para abrir o modal -->

  <!-- Tabela dentro de um container -->
  <section class="tabela-container tabela-container--centralizada">
    <button (click)="abrirModalCadastro()" class="btn btn-cadastro">Cadastrar Usuário</button>
    <table class="tabela-tarefas tabela-tarefas--largura-minima">
      <thead>
        <tr>
          <th>Nome</th>
          <th>E-mail</th>
          <th>Data de Criação</th>
          <th>Administrador</th>
          <th>Editar Categorias</th>
          <th>Editar Usuários</th>
          <th>Head</th>
          <th>Projetos Internos</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuarios">
          <td>{{ usuario.nome }}</td>
          <td>{{ usuario.email }}</td>
          <td>{{ usuario.criado_em | date: 'dd/MM/yyyy' }}</td>
          <td>{{ usuario.admin ? 'Sim' : 'Não' }}</td>
          <td>{{ usuario.adm_categorias ? 'Sim' : 'Não' }}</td>
          <td>{{ usuario.adm_usuarios ? 'Sim' : 'Não' }}</td>
          <td>{{ usuario.head ? 'Sim' : 'Não' }}</td>
          <td>{{ usuario.iprojetos ? 'Sim' : 'Não' }}</td>
          <td>
            <button class="btn btn-editar" (click)="editarUsuario(usuario)">
              <img class="size-6" src="assets/images/icon_primary_text/edit.svg" alt="Ícone de edição" />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Modal de Cadastro -->
  <section class="form-side modal" *ngIf="mostrarModal">
    <div class="cadastro-box">
      <button class="btn btn-fechar" (click)="fecharModal()" aria-label="Fechar">
        <svg class="icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <use href="#icone-close"></use>
        </svg>
      </button>
      <div class="logo">
        <img src="assets/images/login_logo.svg" alt="Logo" />
      </div>
      <div class="cadastro-title">
        {{ modoEdicao ? 'Editar Usuário' : 'Cadastro de Usuário' }}
      </div>
      <form #cadastroForm="ngForm" (ngSubmit)="onSubmit()">
        <label for="nome">Nome</label>
        <input type="text" id="nome" name="nome" required [(ngModel)]="nome" placeholder="Seu nome completo" />

        <label for="email">E-mail</label>
        <input type="email" id="email" name="email" required [(ngModel)]="email" placeholder="Seu e-mail" />

        <!-- Mostrar campo senha somente no cadastro -->
        <ng-container *ngIf="!modoEdicao">
          <label for="senha">Senha</label>
          <input type="password" id="senha" name="senha" required [(ngModel)]="senha" placeholder="Crie uma senha" />
        </ng-container>

        <div class="checkbox-row">
          <label>
            <input type="checkbox" name="admin" [(ngModel)]="admin" /> ADM
          </label>
          <label>
            <input type="checkbox" name="head" [(ngModel)]="head" /> Head
          </label>
          <label>
            <input type="checkbox" name="iprojetos" [(ngModel)]="iprojetos" /> iProjetos
          </label>
          <label>
            <input type="checkbox" name="adm_categorias" [(ngModel)]="adm_categorias" /> Categorias
          </label>
          <label>
            <input type="checkbox" name="adm_usuarios" [(ngModel)]="adm_usuarios" /> Usuários
          </label>
        </div>

        <button *ngIf="modoEdicao" type="button" class="btn btn-resetar" (click)="resetarSenhaUsuario()"
          [disabled]="loading">
          Resetar senha para padrão
        </button>

        <div *ngIf="erroCadastro" class="erro-msg">{{ erroCadastro }}</div>
        <div *ngIf="sucessoCadastro" class="sucesso-msg">{{ sucessoCadastro }}</div>

        <button class="btn btn-atualizar" type="submit" [disabled]="cadastroForm.invalid">
          {{ modoEdicao ? 'Atualizar' : 'Cadastrar' }}
        </button>
      </form>
    </div>
  </section>
</section>